<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <!-- <link href="https://vjs.zencdn.net/7.15.4/video-js.css" rel="stylesheet" /> -->
  <meta name='asg_verification' content='rSdPxWb6hYYNEVhLpF7UQddA'>
  <style>
    .overlay {
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 2;
      display: flex;
      align-items: center;
      justify-self: center;
      display: none;

    }

    .contain {
      width: 100%;
      height: 500px;
      max-width: 800px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-self: center;
    }

    .show {
      display: flex;
    }

    #myvideo {
      display: block;
      margin: 0 auto;
      width: 500px;
      height: 500px;
    }

    .btn-close-modal {
      position: absolute;
      top: 0;
      right: 0;
      width: 50px;
      height: 50px;
      border: 1px solid black;
      color: red;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #mainContainer {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      height: 360px;
      background-color: #dcc;
    }

    #content,
    #adContainer {
      position: absolute;
      top: 0px;
      left: 0px;
      right: 0px;
      left: 0px;
      height: 100%;
    }

    #contentElement {
      width: 640px;
      height: 360px;
      overflow: hidden;
    }

    #playButton {
      margin-top: 10px;
      vertical-align: top;
      width: 350px;
      height: 60px;
      padding: 0;
      font-size: 22px;
      color: white;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.25);
      background: #2c3e50;
      border: 0;
      border-bottom: 2px solid #22303f;
      cursor: pointer;
      -webkit-box-shadow: inset 0 -2px #22303f;
      box-shadow: inset 0 -2px #22303f;
    }
  </style>
</head>

<body>
  <h1>Video Ads</h1>
  <div id="modal" class="overlay">
    <div class="btn-close-modal" onclick="closeModal();">X</div>
    <div class="contain">
      <div id="mainContainer">
        <div id="content">
          <p>Ad container...</p>
          <!-- video -->
        </div>
        <div id="adContainer"></div>
      </div>
    </div>
  </div>

  <button id="playButton">Request ad</button>
  <script type="text/javascript" src="//imasdk.googleapis.com/js/sdkloader/ima3.js"></script>

  <script>
    function closeModal() {
      document.getElementById('modal').classList.remove('show');
      isLoadingAds = false;
      if (adsManager) {
        adsManager.destroy();
      }
    }
    function openModal() {
      document.getElementById('modal').classList.add('show');
    }
    let adsManager;
    let videoElement = document.getElementById('adContainer');
    var adDisplayContainer = new google.ima.AdDisplayContainer(videoElement);
    let isLoadingAds = false;
    // Must be done as the result of a user action on mobile
    adDisplayContainer.initialize();

    // Re-use this AdsLoader instance for the entire lifecycle of your page.
    var adsLoader = new google.ima.AdsLoader(adDisplayContainer);

    // Add event listeners
    adsLoader.addEventListener(
      google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
      onAdsManagerLoaded,
      false);
    adsLoader.addEventListener(
      google.ima.AdErrorEvent.Type.AD_ERROR,
      onAdError,
      false);

    function onAdError(adErrorEvent) {
      // Handle the error logging and destroy the AdsManager
      console.log(adErrorEvent.getError());
      alert("Ads is not run. Please try again");
      closeModal();
      isLoadingAds = false;
      if (adsManager) {
        adsManager.destroy();
      }
    }

    // Request video ads.
    var adsRequest = new google.ima.AdsRequest();
    // JS VPAID
    adsRequest.adTagUrl = '//a.shukriya90.com/api/spots/351044';
    // adsRequest.adTagUrl = '//a.shukriya90.com/api/spots/351016';


    var playButton = document.getElementById('playButton');
    playButton.addEventListener('click', requestAds);

    // Change size of the container when user scale size
    window.addEventListener('resize', function (event) {
      console.log("window resized");
      if (adsManager) {
        var width = videoElement.clientWidth;
        var height = videoElement.clientHeight;
        adsManager.resize(width, height, google.ima.ViewMode.NORMAL);
        if (adsManager) {
          adsManager.resume();
        }
      }
    });

    // Call to the Ad server to get data
    function requestAds() {
      if (isLoadingAds === true) return;
      openModal();
      adsLoader.requestAds(adsRequest);
    }

    // Function handle when vast data pass to the element
    function onAdsManagerLoaded(adsManagerLoadedEvent) {
      // Get the ads manager.
      adsManager = adsManagerLoadedEvent.getAdsManager(document.createElement('video'));

      // Add event catch error when load
      adsManager.addEventListener(
        google.ima.AdErrorEvent.Type.AD_ERROR,
        onAdError);
      // Add event when ads complete
      adsManager.addEventListener(
        google.ima.AdEvent.Type.COMPLETE,
        onAdComplete);

      try {
        var width = videoElement.clientWidth;
        var height = videoElement.clientHeight;
        // Initialize the ads manager. Ad rules playlist will start at this time.
        adsManager.init(width, height, google.ima.ViewMode.NORMAL);
        // Call start to show ads. Single video and overlay ads will
        // start at this time; this call will be ignored for ad rules, as ad rules
        // ads start when the adsManager is initialized.
        adsManager.start();
      } catch (adError) {
        // An error may be thrown if there was a problem with the VAST response.
      }
    }

    // Function handle when the advertise finished (skipped or ended);
    function onAdComplete() {
      console.log("complete");
      alert("You got one point");
      isLoadingAds = false;
      closeModal();
    }
  </script>

</body>

</html>
